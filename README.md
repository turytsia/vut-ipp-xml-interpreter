## PHP Parser [ENG] 7.8/8
**parser.php** is a script that analyzes IPPcode23.

It takes the code from input, breakes it into smaller pieces, validates its syntax and outputs valid [XML](https://www.w3.org/standards/xml/core#:~:text=What%20is%20XML%3F,more%20suitable%20for%20Web%20use.) representation of IPPCode23.
### Usage
```
php8.1 parser.php <[source] [--options] [-flags] [--help]
```

### Implementation
[![](https://mermaid.ink/img/pako:eNqFVm1P2zAQ_iuWyYcUWtS0tIA1IU2DvUhDSGyapilSZBrTRkvsynY6sq7_fWc7aZy-wAfS-Pzc3XOvYY1nImWY4FlOlbrN6FzSIuYx_8KVluVMZ4KjweAGoTsphfxMeZozSZABLEv9ntO8Ukwehuxb8c6PZc4ImoliSSVTSAuDf1gyCfooxqcxBo1TeIvgzdMjCBQ0Es8-OrLom1rvB82zlGohVZfB6zg_nNeQr2EdV7h9ZDSFO4JKBcGJUoPMcu7ycVEKX7O1C54-CllQreH07t9g4Jt2lmP-8_7rJ8YhD0DOgR6ss63QprUr2guvk965gzF1SNMV0aO5H2HMbS912wGhdczPEGIvmU7-ZHqRMHMbBvCTmBYkNf4DvKs-CgqmFJ0bMVDL-LwXIIRWIktjvvF87DSUdTNAKBCuNRToUylpZZwn4KiGhw0g0dWSAcqCepbinOmkUQ97rTpaUJVw4d-hJyHyDqG2YEDkBD3bY5JnnIWBeYInXkEsLijDVbJCrFjCeAqCBrSNeQ8HA1MwrtXbSFYsdXUU5nH2G9amL8iMhNSRDzqJ69VFOLN5ssA2SX5l2pFpap-pZGG9hI5TQ6pJo4OsqAzh79i1qoqn0DyOAUxBQ_PwAR1ETp9YHtrnAYwXQ71fLPvAmaxF303XWPGK5uU2v8e6rLnvHzLT2ylGux9cMTgtPAcgENLOf8a1O25bfVuwwM1wnvhQVzFjLez5hLv9TtqGtxfGgJFaE7tN0ywBv2s8FlkbiyJH5tBrtR7ptlarDAT2O8zffHbYAreECLp9uL8Vs9LMiZUvpTCfNWJU7nLm5F0eje-T7frzCYR-KMSvEWRmbynt7sz1W8lQvCHhDZdj4Zdqg_u4YLBQshQ-2GAVwfrWC4gnxvC5xSmVv2PscLTU4lvFZ5iAadbH5RJmkdXfd0yeaa5AytIMCN7X_wGYnz5eUv5LiKJRhCMma_yCSTQ-H0-uxqPocjKZjofw0scVJoPo_Go0jMbRdBqNxhfX16NNH_-1FqLz4fBiPJpeR9HlaDKKrsab_4Cv8uM?type=png)](https://mermaid.live/edit#pako:eNqFVm1P2zAQ_iuWyYcUWtS0tIA1IU2DvUhDSGyapilSZBrTRkvsynY6sq7_fWc7aZy-wAfS-Pzc3XOvYY1nImWY4FlOlbrN6FzSIuYx_8KVluVMZ4KjweAGoTsphfxMeZozSZABLEv9ntO8Ukwehuxb8c6PZc4ImoliSSVTSAuDf1gyCfooxqcxBo1TeIvgzdMjCBQ0Es8-OrLom1rvB82zlGohVZfB6zg_nNeQr2EdV7h9ZDSFO4JKBcGJUoPMcu7ycVEKX7O1C54-CllQreH07t9g4Jt2lmP-8_7rJ8YhD0DOgR6ss63QprUr2guvk965gzF1SNMV0aO5H2HMbS912wGhdczPEGIvmU7-ZHqRMHMbBvCTmBYkNf4DvKs-CgqmFJ0bMVDL-LwXIIRWIktjvvF87DSUdTNAKBCuNRToUylpZZwn4KiGhw0g0dWSAcqCepbinOmkUQ97rTpaUJVw4d-hJyHyDqG2YEDkBD3bY5JnnIWBeYInXkEsLijDVbJCrFjCeAqCBrSNeQ8HA1MwrtXbSFYsdXUU5nH2G9amL8iMhNSRDzqJ69VFOLN5ssA2SX5l2pFpap-pZGG9hI5TQ6pJo4OsqAzh79i1qoqn0DyOAUxBQ_PwAR1ETp9YHtrnAYwXQ71fLPvAmaxF303XWPGK5uU2v8e6rLnvHzLT2ylGux9cMTgtPAcgENLOf8a1O25bfVuwwM1wnvhQVzFjLez5hLv9TtqGtxfGgJFaE7tN0ywBv2s8FlkbiyJH5tBrtR7ptlarDAT2O8zffHbYAreECLp9uL8Vs9LMiZUvpTCfNWJU7nLm5F0eje-T7frzCYR-KMSvEWRmbynt7sz1W8lQvCHhDZdj4Zdqg_u4YLBQshQ-2GAVwfrWC4gnxvC5xSmVv2PscLTU4lvFZ5iAadbH5RJmkdXfd0yeaa5AytIMCN7X_wGYnz5eUv5LiKJRhCMma_yCSTQ-H0-uxqPocjKZjofw0scVJoPo_Go0jMbRdBqNxhfX16NNH_-1FqLz4fBiPJpeR9HlaDKKrsab_4Cv8uM)

The whole implementation is just a pipe of specific parts of a parser that are connected with each other. 
- **InputReader** is a class, responsible for reading contents from input.
Besides reading, it also uses [trait](https://www.php.net/manual/en/language.oop5.traits.php) *Formatter* that provides 3 methods to format string:
    - *remove_endings* - removes `\n` from the end of the line
    - *remove_comments* - removes comments inside of a line
    - *remove_empty* - removes empty lines
    >**Note**
    >There is *format_line($line)* method that combines all the methods above in the same order. This specific order perfectly filters all the lines. 

- **InputAnalyser** takes formatted lines, after *InputReader* is done reading input, and converts each into *Instruction* object. Also validates header of a program.
    - *Instruction* is a special class to ease work with instructions, that takes a formatted line as an argument for the constructor and validates it while creating new object, using helper class *InstructionRule* where specific rules for exact instruction are defined.
    - *Operand* is similiar class to *Instruction* that is being created in pair with *Instruction* for the same reason.
- **OutputGenerator** is a component that produces XML out of instructions, that it takes as the array, generated by *InputAnalyzer*.
    >**Note**
    >The *OutputGenerator* is only a child of *XMLGenerator*. That means that object itself doesn't generate the entire XML structure. It uses special methods that are inherited from *XMLGenerator*.
- **XMLGenerator** is configured class that generates main XML structure.

To validate data during all the process, some of the objects are using class collection *Validators*, where entire validation logic is stored. If validation fails anywhere, *ErrorHandler* will throw the error.

## Python XML interpret [ENG]
This program is an interpreter for files that contain programs written in the IPPcode23 language in XML representation.

### Usage
```
python3 interpret.py [[--source=[SOURCE_FILE]] [--input=[INPUT_FILE]]] [--help|-h]
```

`--source` specifies the path to the XML file that contains the program to be interpreted.

`--input` specifies the path to a file that contains the input data for the program. 

If source or input were not provided, the interpreter will wait for input from the standard input stream.


### XML Format
The input XML file must conform to the following format:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<program language="IPPcode23">
    <instruction order="[ORDER]" opcode="[OPCODE]">
        <arg1 type="[TYPE]">[VALUE]</arg1>
        <arg2 type="[TYPE]">[VALUE]</arg2>
        <arg3 type="[TYPE]">[VALUE]</arg3>
    </instruction>
    ...
</program>
```

The program element must have a `language` attribute with the value *IPPcode23*.

Each instruction element represents a single instruction in the program, and must have the following attributes:

`order`: an integer representing the order of the instruction in the program
`opcode`: a string representing the opcode of the instruction

Each instruction element may have up to three arg elements, each with the following attributes:

`type`: a string representing the type of the argument ("int", "string", "bool", "nil", "var", "type" or "nil")
`value`: the value of the argument, represented as a string


### Implementation
Click [here](https://mermaid.ink/img/pako:eNqtV21v2zYQ_iuE9sVuXcMvqd0K-bQuGQIk64AsRTEIEBiJdolIpEDRgT3P_u07HimJeon7ZfngiPcc7-W5O4o6BolMWRAGSUbL8jdOt4rmkYgErgm52Ses0FwKeD5G4j0hbM_1iIUkrqExeZU8jcTJ29egbl_OypJuYV-pFRdbIzKeQ8KFbm39irtulJKKHMmpEn9_uL-VKqd6CHkSbF-wRLO0hz6ynArNkx7w16FgPeE3qjh9ztiTSNmGiwF7t8DP0L5sd2HT14IpKlLU6keIhKDKYOZ3QjMlaOYBkfD4vf73wweftT7Y5m4Q7zDY12nx2IdrNvvQMKd9vYbZIRs9foc46LA8kMUA132tFuOR8GbgHaCNttfvJn87IgT-Wg2NUPx4yJ_tJLya-EJCxcGsNKAh6kTiF-N55HCYi3FIzDYD3GaS1tDGLDzQZlWhdsA8-Fcpswp8hmcP-oPXiOANgNF7cdclLmOoZjc1ENnMykSaZLCQCBmhgIU_9SXTcQlGR-bHOhwjETLG_SNnxaUxQKX5bVFpbDh_AxRW3A5SWIFvUFjBAxRWUI_CCoCETHFHtsIdk-8JL2OIbzS2Bp0Ew-rI7M6O0Dx2ROC9kfRIu6fPLGuxhnb9WmN3N1XvS23oXSlabtz9SVXJ6nPKl8V3AnzuEhw0jIRlLGdCh-YEmt7c48LIZWHfDU3XSJUy1RLYYS9hkJSihzNasObOBi-My9HYcQMp83TUbqb4dyaY4gkG1_TUWzFRrVsBaLbX_vrnDh0L9iRozncnxinqSW1cPbGrpnsX9BLBefXc_UwHh_qyiq39ZZ26E1wPvGsgr_QtuGfQbPcO3Ovp1JkIYbJf5YsZ8g6ObejBtkGva-ch-aIY1QZq3ql1OMeLDcerhmx3G7o4u-r6bX3RKx6M4A_STqmmIUl5gua3cCa-UgXniIr989IdF-7UtWen0_OQdpehkwcq4LKlrK_tRqFNRFCSOYlNBuVnBHRb9X-IDK55SEOMlu18FLvyR2sti2aJqaB_JNNPZ4DSR02TFwfDPHjceoXCGThXnt2Lp0GqGGrvnf7yfbzdhe1Aa61ICKkZ2cDVrRVrFOCS5G7N88IePCXJJPzIDfRe3VflNIKbxR1JWcJTlhKwCe8XQtOU6B8sB1XbsEb4wlgBnYU3ebhji4SXbBoFDWdfaJZZ57Y_EljXnc2r89MwlZmBtu9RjyM84Fhe6MPg-8Ybh7ow6MfPp3LnKaNb0GFKjzzV0Dc4djq1HRPBkKWhOtZ5e-VpzS7o9IMPyVNpC9ncdup6h2TnwEgEkyBncMvmKXxO4UUwCkxxWBSE8JhS9WKqcAI9utPy8SCSIARnbBLsCuhZ5r6-gnBDsxKkLOVaqgf3fWb-TYKCir-lzKuNsAzCY7APws-r6Wr9cbFaflyvZ_PVfBIcgnC-WE6v5svZ58XVern4BAqnSfAP7p9N11dXs9V8tl7M14vlYvXp9B_OJAro?type=png)[](https://mermaid.live/edit#pako:eNqtV21v2zYQ_iuE9sVuXcMvqd0K-bQuGQIk64AsRTEIEBiJdolIpEDRgT3P_u07HimJeon7ZfngiPcc7-W5O4o6BolMWRAGSUbL8jdOt4rmkYgErgm52Ses0FwKeD5G4j0hbM_1iIUkrqExeZU8jcTJ29egbl_OypJuYV-pFRdbIzKeQ8KFbm39irtulJKKHMmpEn9_uL-VKqd6CHkSbF-wRLO0hz6ynArNkx7w16FgPeE3qjh9ztiTSNmGiwF7t8DP0L5sd2HT14IpKlLU6keIhKDKYOZ3QjMlaOYBkfD4vf73wweftT7Y5m4Q7zDY12nx2IdrNvvQMKd9vYbZIRs9foc46LA8kMUA132tFuOR8GbgHaCNttfvJn87IgT-Wg2NUPx4yJ_tJLya-EJCxcGsNKAh6kTiF-N55HCYi3FIzDYD3GaS1tDGLDzQZlWhdsA8-Fcpswp8hmcP-oPXiOANgNF7cdclLmOoZjc1ENnMykSaZLCQCBmhgIU_9SXTcQlGR-bHOhwjETLG_SNnxaUxQKX5bVFpbDh_AxRW3A5SWIFvUFjBAxRWUI_CCoCETHFHtsIdk-8JL2OIbzS2Bp0Ew-rI7M6O0Dx2ROC9kfRIu6fPLGuxhnb9WmN3N1XvS23oXSlabtz9SVXJ6nPKl8V3AnzuEhw0jIRlLGdCh-YEmt7c48LIZWHfDU3XSJUy1RLYYS9hkJSihzNasObOBi-My9HYcQMp83TUbqb4dyaY4gkG1_TUWzFRrVsBaLbX_vrnDh0L9iRozncnxinqSW1cPbGrpnsX9BLBefXc_UwHh_qyiq39ZZ26E1wPvGsgr_QtuGfQbPcO3Ovp1JkIYbJf5YsZ8g6ObejBtkGva-ch-aIY1QZq3ql1OMeLDcerhmx3G7o4u-r6bX3RKx6M4A_STqmmIUl5gua3cCa-UgXniIr989IdF-7UtWen0_OQdpehkwcq4LKlrK_tRqFNRFCSOYlNBuVnBHRb9X-IDK55SEOMlu18FLvyR2sti2aJqaB_JNNPZ4DSR02TFwfDPHjceoXCGThXnt2Lp0GqGGrvnf7yfbzdhe1Aa61ICKkZ2cDVrRVrFOCS5G7N88IePCXJJPzIDfRe3VflNIKbxR1JWcJTlhKwCe8XQtOU6B8sB1XbsEb4wlgBnYU3ebhji4SXbBoFDWdfaJZZ57Y_EljXnc2r89MwlZmBtu9RjyM84Fhe6MPg-8Ybh7ow6MfPp3LnKaNb0GFKjzzV0Dc4djq1HRPBkKWhOtZ5e-VpzS7o9IMPyVNpC9ncdup6h2TnwEgEkyBncMvmKXxO4UUwCkxxWBSE8JhS9WKqcAI9utPy8SCSIARnbBLsCuhZ5r6-gnBDsxKkLOVaqgf3fWb-TYKCir-lzKuNsAzCY7APws-r6Wr9cbFaflyvZ_PVfBIcgnC-WE6v5svZ58XVern4BAqnSfAP7p9N11dXs9V8tl7M14vlYvXp9B_OJAro) in order to see the entire diagram.
[![](https://mermaid.ink/img/pako:eNqtV21v2zYQ_iuE9sVuXcMvqd0K-bQuGQIk64AsRTEIEBiJdolIpEDRgT3P_u07HimJeon7ZfngiPcc7-W5O4o6BolMWRAGSUbL8jdOt4rmkYgErgm52Ses0FwKeD5G4j0hbM_1iIUkrqExeZU8jcTJ29egbl_OypJuYV-pFRdbIzKeQ8KFbm39irtulJKKHMmpEn9_uL-VKqd6CHkSbF-wRLO0hz6ynArNkx7w16FgPeE3qjh9ztiTSNmGiwF7t8DP0L5sd2HT14IpKlLU6keIhKDKYOZ3QjMlaOYBkfD4vf73wweftT7Y5m4Q7zDY12nx2IdrNvvQMKd9vYbZIRs9foc46LA8kMUA132tFuOR8GbgHaCNttfvJn87IgT-Wg2NUPx4yJ_tJLya-EJCxcGsNKAh6kTiF-N55HCYi3FIzDYD3GaS1tDGLDzQZlWhdsA8-Fcpswp8hmcP-oPXiOANgNF7cdclLmOoZjc1ENnMykSaZLCQCBmhgIU_9SXTcQlGR-bHOhwjETLG_SNnxaUxQKX5bVFpbDh_AxRW3A5SWIFvUFjBAxRWUI_CCoCETHFHtsIdk-8JL2OIbzS2Bp0Ew-rI7M6O0Dx2ROC9kfRIu6fPLGuxhnb9WmN3N1XvS23oXSlabtz9SVXJ6nPKl8V3AnzuEhw0jIRlLGdCh-YEmt7c48LIZWHfDU3XSJUy1RLYYS9hkJSihzNasObOBi-My9HYcQMp83TUbqb4dyaY4gkG1_TUWzFRrVsBaLbX_vrnDh0L9iRozncnxinqSW1cPbGrpnsX9BLBefXc_UwHh_qyiq39ZZ26E1wPvGsgr_QtuGfQbPcO3Ovp1JkIYbJf5YsZ8g6ObejBtkGva-ch-aIY1QZq3ql1OMeLDcerhmx3G7o4u-r6bX3RKx6M4A_STqmmIUl5gua3cCa-UgXniIr989IdF-7UtWen0_OQdpehkwcq4LKlrK_tRqFNRFCSOYlNBuVnBHRb9X-IDK55SEOMlu18FLvyR2sti2aJqaB_JNNPZ4DSR02TFwfDPHjceoXCGThXnt2Lp0GqGGrvnf7yfbzdhe1Aa61ICKkZ2cDVrRVrFOCS5G7N88IePCXJJPzIDfRe3VflNIKbxR1JWcJTlhKwCe8XQtOU6B8sB1XbsEb4wlgBnYU3ebhji4SXbBoFDWdfaJZZ57Y_EljXnc2r89MwlZmBtu9RjyM84Fhe6MPg-8Ybh7ow6MfPp3LnKaNb0GFKjzzV0Dc4djq1HRPBkKWhOtZ5e-VpzS7o9IMPyVNpC9ncdup6h2TnwEgEkyBncMvmKXxO4UUwCkxxWBSE8JhS9WKqcAI9utPy8SCSIARnbBLsCuhZ5r6-gnBDsxKkLOVaqgf3fWb-TYKCir-lzKuNsAzCY7APws-r6Wr9cbFaflyvZ_PVfBIcgnC-WE6v5svZ58XVern4BAqnSfAP7p9N11dXs9V8tl7M14vlYvXp9B_OJAro?type=png)](https://mermaid.live/edit#pako:eNqtV21v2zYQ_iuE9sVuXcMvqd0K-bQuGQIk64AsRTEIEBiJdolIpEDRgT3P_u07HimJeon7ZfngiPcc7-W5O4o6BolMWRAGSUbL8jdOt4rmkYgErgm52Ses0FwKeD5G4j0hbM_1iIUkrqExeZU8jcTJ29egbl_OypJuYV-pFRdbIzKeQ8KFbm39irtulJKKHMmpEn9_uL-VKqd6CHkSbF-wRLO0hz6ynArNkx7w16FgPeE3qjh9ztiTSNmGiwF7t8DP0L5sd2HT14IpKlLU6keIhKDKYOZ3QjMlaOYBkfD4vf73wweftT7Y5m4Q7zDY12nx2IdrNvvQMKd9vYbZIRs9foc46LA8kMUA132tFuOR8GbgHaCNttfvJn87IgT-Wg2NUPx4yJ_tJLya-EJCxcGsNKAh6kTiF-N55HCYi3FIzDYD3GaS1tDGLDzQZlWhdsA8-Fcpswp8hmcP-oPXiOANgNF7cdclLmOoZjc1ENnMykSaZLCQCBmhgIU_9SXTcQlGR-bHOhwjETLG_SNnxaUxQKX5bVFpbDh_AxRW3A5SWIFvUFjBAxRWUI_CCoCETHFHtsIdk-8JL2OIbzS2Bp0Ew-rI7M6O0Dx2ROC9kfRIu6fPLGuxhnb9WmN3N1XvS23oXSlabtz9SVXJ6nPKl8V3AnzuEhw0jIRlLGdCh-YEmt7c48LIZWHfDU3XSJUy1RLYYS9hkJSihzNasObOBi-My9HYcQMp83TUbqb4dyaY4gkG1_TUWzFRrVsBaLbX_vrnDh0L9iRozncnxinqSW1cPbGrpnsX9BLBefXc_UwHh_qyiq39ZZ26E1wPvGsgr_QtuGfQbPcO3Ovp1JkIYbJf5YsZ8g6ObejBtkGva-ch-aIY1QZq3ql1OMeLDcerhmx3G7o4u-r6bX3RKx6M4A_STqmmIUl5gua3cCa-UgXniIr989IdF-7UtWen0_OQdpehkwcq4LKlrK_tRqFNRFCSOYlNBuVnBHRb9X-IDK55SEOMlu18FLvyR2sti2aJqaB_JNNPZ4DSR02TFwfDPHjceoXCGThXnt2Lp0GqGGrvnf7yfbzdhe1Aa61ICKkZ2cDVrRVrFOCS5G7N88IePCXJJPzIDfRe3VflNIKbxR1JWcJTlhKwCe8XQtOU6B8sB1XbsEb4wlgBnYU3ebhji4SXbBoFDWdfaJZZ57Y_EljXnc2r89MwlZmBtu9RjyM84Fhe6MPg-8Ybh7ow6MfPp3LnKaNb0GFKjzzV0Dc4djq1HRPBkKWhOtZ5e-VpzS7o9IMPyVNpC9ncdup6h2TnwEgEkyBncMvmKXxO4UUwCkxxWBSE8JhS9WKqcAI9utPy8SCSIARnbBLsCuhZ5r6-gnBDsxKkLOVaqgf3fWb-TYKCir-lzKuNsAzCY7APws-r6Wr9cbFaflyvZ_PVfBIcgnC-WE6v5svZ58XVern4BAqnSfAP7p9N11dXs9V8tl7M14vlYvXp9B_OJAro)

#### Idea
Since the interpret had to be implemented in Python, I have decided to stick with OOP approach as much as it was possible for me.

I divided task into smaller subtasks:
- Handle options, input and basic output
- Parse XML using [ETree](https://docs.python.org/3/library/xml.etree.elementtree.html).
- Implement types using classes. (Var is subset for Symb)
- Implement data stack, frame stack and call stack.
- Create error handling mechanism, that is native to Python.
- Implement static semantic analysis, variable checking. Find all the labels that are being used in the code.
- Implement instructions and operations. Start testing.

For most subtasks was created its class that would
implement all the necessary features in order to work correctly.

In the next sections I will note some of these classes and approaches I followed to ease development.

#### Error handling
Interpret has its own error codes and messages that needs to be shown to a user in some error cases.

For that I decided to customize already existing error handling in Python by extending `Exception` class with attribudes `code` and `message`.

When error occures, exception can be easily raised with custom message and the program will gracefully exit with pre-defined error code.

#### Parser
For XML parsing interpret is using not only ETree, that I mentioned earlier, but also class `Parser`. It's made to analyze correctness and validity of a language hidden behind XML representation (IFJcode23).

When implementing this class, I have noticed that most of its subclasses were sharing the same idea but with different functionalit, so I decided to created [abstract](https://docs.python.org/3/library/abc.html) class `_GenericParseType`.

#### Types

In interpret `Var` literal is a subset for `Symb`. To implement such behaviour I have used inheritance (see diagram).